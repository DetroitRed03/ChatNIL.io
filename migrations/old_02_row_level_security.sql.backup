-- Row Level Security (RLS) Policies
-- This ensures users can only access their own data

-- Enable RLS on all tables
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE athlete_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE parent_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE coach_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_attachments ENABLE ROW LEVEL SECURITY;

-- Users table policies
CREATE POLICY "Users can view own profile" ON users
  FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON users
  FOR UPDATE USING (auth.uid() = id);

-- Athlete profiles policies
CREATE POLICY "Athletes can view own profile" ON athlete_profiles
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Athletes can insert own profile" ON athlete_profiles
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Athletes can update own profile" ON athlete_profiles
  FOR UPDATE USING (auth.uid() = user_id);

-- Parent profiles policies
CREATE POLICY "Parents can view own profile" ON parent_profiles
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Parents can insert own profile" ON parent_profiles
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Parents can update own profile" ON parent_profiles
  FOR UPDATE USING (auth.uid() = user_id);

-- Coach profiles policies
CREATE POLICY "Coaches can view own profile" ON coach_profiles
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Coaches can insert own profile" ON coach_profiles
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Coaches can update own profile" ON coach_profiles
  FOR UPDATE USING (auth.uid() = user_id);

-- Chat sessions policies
CREATE POLICY "Users can view own chat sessions" ON chat_sessions
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own chat sessions" ON chat_sessions
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own chat sessions" ON chat_sessions
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own chat sessions" ON chat_sessions
  FOR DELETE USING (auth.uid() = user_id);

-- Chat messages policies
CREATE POLICY "Users can view own chat messages" ON chat_messages
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own chat messages" ON chat_messages
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own chat messages" ON chat_messages
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own chat messages" ON chat_messages
  FOR DELETE USING (auth.uid() = user_id);

-- Chat attachments policies
CREATE POLICY "Users can view own chat attachments" ON chat_attachments
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own chat attachments" ON chat_attachments
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own chat attachments" ON chat_attachments
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own chat attachments" ON chat_attachments
  FOR DELETE USING (auth.uid() = user_id);